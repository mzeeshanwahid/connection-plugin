{"version":3,"file":"connection-plugin.esm.js","sources":["../src/utils.js","../src/picker/view.js","../src/picker/index.js","../src/flow.js","../src/events.js","../src/index.ts"],"sourcesContent":["\"use strict\";\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction toTrainCase(str) {\n    return str.toLowerCase().replace(/ /g, '-');\n}\nfunction getMapItemRecursively(map, el) {\n    return map.get(el) || (el.parentElement ? getMapItemRecursively(map, el.parentElement) : null);\n}\nexports.getMapItemRecursively = getMapItemRecursively;\nfunction defaultPath(points, curvature) {\n    var x1 = points[0], y1 = points[1], x2 = points[2], y2 = points[3];\n    var hx1 = x1 + Math.abs(x2 - x1) * curvature;\n    var hx2 = x2 - Math.abs(x2 - x1) * curvature;\n    return \"M \" + x1 + \" \" + y1 + \" C \" + hx1 + \" \" + y1 + \" \" + hx2 + \" \" + y2 + \" \" + x2 + \" \" + y2;\n}\nexports.defaultPath = defaultPath;\nfunction renderPathData(emitter, points, connection) {\n    var data = { points: points, connection: connection, d: '' };\n    emitter.trigger('connectionpath', data);\n    return data.d || defaultPath(points, 0.4);\n}\nexports.renderPathData = renderPathData;\nfunction updateConnection(_a) {\n    var el = _a.el, d = _a.d;\n    var path = el.querySelector('.connection path');\n    if (!path)\n        throw new Error('Path of connection was broken');\n    path.setAttribute('d', d);\n}\nexports.updateConnection = updateConnection;\nfunction renderConnection(_a) {\n    var _b;\n    var el = _a.el, d = _a.d, connection = _a.connection;\n    var classed = !connection ? [] : [\n        'input-' + toTrainCase(connection.input.name),\n        'output-' + toTrainCase(connection.output.name),\n        'socket-input-' + toTrainCase(connection.input.socket.name),\n        'socket-output-' + toTrainCase(connection.output.socket.name)\n    ];\n    var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    (_b = svg.classList).add.apply(_b, __spreadArrays(['connection'], classed));\n    path.classList.add('main-path');\n    path.setAttribute('d', d);\n    svg.appendChild(path);\n    el.appendChild(svg);\n    updateConnection({ el: el, d: d });\n}\nexports.renderConnection = renderConnection;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar rete_1 = require(\"rete\");\nvar utils_1 = require(\"../utils\");\nvar PickerView = /** @class */ (function () {\n    function PickerView(emitter, editorView) {\n        this.emitter = emitter;\n        this.editorView = editorView;\n        this.el = document.createElement('div');\n        this.el.style.position = 'absolute';\n        this.editorView.area.appendChild(this.el);\n    }\n    PickerView.prototype.updatePseudoConnection = function (io) {\n        if (io !== null) {\n            this.renderConnection(io);\n        }\n        else if (this.el.parentElement) {\n            this.el.innerHTML = '';\n        }\n    };\n    PickerView.prototype.getPoints = function (io) {\n        var mouse = this.editorView.area.mouse;\n        if (!io.node)\n            throw new Error('Node in output/input not found');\n        var node = this.editorView.nodes.get(io.node);\n        if (!node)\n            throw new Error('Node view not found');\n        var _a = node.getSocketPosition(io), x1 = _a[0], y1 = _a[1];\n        return io instanceof rete_1.Output\n            ? [x1, y1, mouse.x, mouse.y]\n            : [mouse.x, mouse.y, x1, y1];\n    };\n    PickerView.prototype.updateConnection = function (io) {\n        var d = utils_1.renderPathData(this.emitter, this.getPoints(io));\n        utils_1.updateConnection({ el: this.el, d: d });\n    };\n    PickerView.prototype.renderConnection = function (io) {\n        var d = utils_1.renderPathData(this.emitter, this.getPoints(io));\n        utils_1.renderConnection({ el: this.el, d: d });\n    };\n    return PickerView;\n}());\nexports.PickerView = PickerView;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar rete_1 = require(\"rete\");\nvar view_1 = require(\"./view\");\nvar Picker = /** @class */ (function () {\n    function Picker(editor) {\n        var _this = this;\n        this._io = null;\n        this.editor = editor;\n        this.view = new view_1.PickerView(editor, editor.view);\n        editor.on('mousemove', function () { return _this.io && _this.view.updateConnection(_this.io); });\n    }\n    Object.defineProperty(Picker.prototype, \"io\", {\n        get: function () {\n            return this._io;\n        },\n        set: function (io) {\n            this._io = io;\n            this.view.updatePseudoConnection(io);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Picker.prototype.reset = function () {\n        this.io = null;\n    };\n    Picker.prototype.pickOutput = function (output) {\n        if (!this.editor.trigger('connectionpick', output))\n            return;\n        if (this.io instanceof rete_1.Input) {\n            if (!output.multipleConnections && output.hasConnection())\n                this.editor.removeConnection(output.connections[0]);\n            this.editor.connect(output, this.io);\n            this.reset();\n            return;\n        }\n        if (this.io)\n            this.reset();\n        this.io = output;\n    };\n    Picker.prototype.pickInput = function (input) {\n        var _this = this;\n        if (!this.editor.trigger('connectionpick', input))\n            return;\n        if (this.io === null) {\n            if (input.hasConnection()) {\n                this.io = input.connections[0].output;\n                this.editor.removeConnection(input.connections[0]);\n            }\n            else {\n                this.io = input;\n            }\n            return true;\n        }\n        if (!input.multipleConnections && input.hasConnection())\n            this.editor.removeConnection(input.connections[0]);\n        if (!this.io.multipleConnections && this.io.hasConnection())\n            this.editor.removeConnection(this.io.connections[0]);\n        if (this.io instanceof rete_1.Output && this.io.connectedTo(input)) {\n            var connection = input.connections.find(function (c) { return c.output === _this.io; });\n            if (connection) {\n                this.editor.removeConnection(connection);\n            }\n        }\n        if (this.io instanceof rete_1.Output) {\n            this.editor.connect(this.io, input);\n            this.reset();\n        }\n    };\n    Picker.prototype.pickConnection = function (connection) {\n        var output = connection.output;\n        this.editor.removeConnection(connection);\n        this.io = output;\n    };\n    return Picker;\n}());\nexports.Picker = Picker;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Flow = /** @class */ (function () {\n    function Flow(picker) {\n        this.picker = picker;\n        this.target = null;\n    }\n    Flow.prototype.act = function (_a) {\n        var input = _a.input, output = _a.output;\n        if (this.unlock(input || output))\n            return;\n        if (input)\n            this.picker.pickInput(input);\n        else if (output)\n            this.picker.pickOutput(output);\n        else\n            this.picker.reset();\n    };\n    Flow.prototype.start = function (params, io) {\n        this.act(params);\n        this.target = io;\n    };\n    Flow.prototype.complete = function (params) {\n        if (params === void 0) { params = {}; }\n        this.act(params);\n    };\n    Flow.prototype.hasTarget = function () {\n        return Boolean(this.target);\n    };\n    Flow.prototype.unlock = function (io) {\n        var target = this.target;\n        this.target = null;\n        return target && target === io;\n    };\n    return Flow;\n}());\nexports.Flow = Flow;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n","import { NodeEditor } from 'rete';\nimport { renderConnection, renderPathData, updateConnection, getMapItemRecursively } from './utils';\nimport { Picker } from './picker';\nimport { Flow, FlowParams } from './flow';\nimport './events';\nimport './index.sass';\n\nfunction install(editor: NodeEditor) {\n    editor.bind('connectionpath');\n    editor.bind('connectiondrop');\n    editor.bind('connectionpick');\n    editor.bind('resetconnection');\n    \n    const picker = new Picker(editor);\n    const flow = new Flow(picker);\n    const socketsParams = new WeakMap<Element, FlowParams>();\n    \n    function pointerDown(this: HTMLElement, e: PointerEvent) {\n        const flowParams = socketsParams.get(this);\n\n        if(flowParams) {\n            const { input, output } = flowParams;\n            \n            editor.view.container.dispatchEvent(new PointerEvent('pointermove', e));\n            e.preventDefault();\n            e.stopPropagation();\n            flow.start({ input, output }, input || output);\n        }\n    }\n\n    function pointerUp(this: Window, e: PointerEvent) {\n        const flowEl = document.elementFromPoint(e.clientX, e.clientY);\n\n        if(picker.io) {\n            editor.trigger('connectiondrop', picker.io)\n        }\n        if(flowEl) {\n            flow.complete(getMapItemRecursively(socketsParams, flowEl) || {})\n        }\n    }\n\n    editor.on('resetconnection', () => flow.complete());\n\n    editor.on('rendersocket', ({ el, input, output }) => {\n        socketsParams.set(el, { input, output });\n\n        el.removeEventListener('pointerdown', pointerDown);\n        el.addEventListener('pointerdown', pointerDown);\n    });\n\n    window.addEventListener('pointerup', pointerUp);\n\n    editor.on('renderconnection', ({ el, connection, points }) => {\n        const d = renderPathData(editor, points, connection);\n\n        renderConnection({ el, d, connection })\n    });\n\n    editor.on('updateconnection', ({ el, connection, points }) => {\n        const d = renderPathData(editor, points, connection);\n\n        updateConnection({ el, d });\n    });\n\n    editor.on('destroy', () => {\n        window.removeEventListener('pointerup', pointerUp);\n    });\n}\n\nexport default {\n    name: 'connection',\n    install\n}\nexport { defaultPath } from './utils';"],"names":["__spreadArrays","this","s","i","il","arguments","length","r","Array","k","a","j","jl","Object","defineProperty","exports","value","toTrainCase","str","toLowerCase","replace","getMapItemRecursively","map","el","get","parentElement","defaultPath","points","curvature","x1","y1","x2","y2","hx1","Math","abs","hx2","renderPathData","emitter","connection","data","d","trigger","updateConnection","_a","path","querySelector","Error","setAttribute","renderConnection","_b","classed","input","name","output","socket","svg","document","createElementNS","classList","add","apply","appendChild","PickerView","editorView","createElement","style","position","area","prototype","updatePseudoConnection","io","innerHTML","getPoints","mouse","node","nodes","getSocketPosition","rete_1","Output","x","y","utils_1","Picker","editor","_this","_io","view","view_1","on","set","enumerable","configurable","reset","pickOutput","Input","multipleConnections","hasConnection","removeConnection","connections","connect","pickInput","connectedTo","find","c","pickConnection","Flow","picker","target","act","unlock","start","params","complete","hasTarget","Boolean","install","bind","flow","socketsParams","WeakMap","pointerDown","e","flowParams","container","dispatchEvent","PointerEvent","preventDefault","stopPropagation","pointerUp","flowEl","elementFromPoint","clientX","clientY","removeEventListener","addEventListener","window"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;MACIA,cAAc,GAAIC,cAAAA,IAAQA,cAAAA,CAAKD,cAAd,IAAiC,YAAY;SACzD,IAAIE,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAG,CAAf,EAAkBC,EAAE,GAAGC,SAAS,CAACC,MAAtC,EAA8CH,CAAC,GAAGC,EAAlD,EAAsDD,CAAC,EAAvD;MAA2DD,CAAC,IAAIG,SAAS,CAACF,CAAD,CAAT,CAAaG,MAAlB;;;SACtD,IAAIC,CAAC,GAAGC,KAAK,CAACN,CAAD,CAAb,EAAkBO,CAAC,GAAG,CAAtB,EAAyBN,CAAC,GAAG,CAAlC,EAAqCA,CAAC,GAAGC,EAAzC,EAA6CD,CAAC,EAA9C;WACS,IAAIO,CAAC,GAAGL,SAAS,CAACF,CAAD,CAAjB,EAAsBQ,CAAC,GAAG,CAA1B,EAA6BC,EAAE,GAAGF,CAAC,CAACJ,MAAzC,EAAiDK,CAAC,GAAGC,EAArD,EAAyDD,CAAC,IAAIF,CAAC,EAA/D;QACIF,CAAC,CAACE,CAAD,CAAD,GAAOC,CAAC,CAACC,CAAD,CAAR;;;;WACDJ,CAAP;GALJ;;EAOAM,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;IAAEC,KAAK,EAAE;GAAtD;;WACSC,WAAT,CAAqBC,GAArB,EAA0B;WACfA,GAAG,CAACC,WAAJ,GAAkBC,OAAlB,CAA0B,IAA1B,EAAgC,GAAhC,CAAP;;;WAEKC,qBAAT,CAA+BC,GAA/B,EAAoCC,EAApC,EAAwC;WAC7BD,GAAG,CAACE,GAAJ,CAAQD,EAAR,MAAgBA,EAAE,CAACE,aAAH,GAAmBJ,qBAAqB,CAACC,GAAD,EAAMC,EAAE,CAACE,aAAT,CAAxC,GAAkE,IAAlF,CAAP;;;EAEJV,6BAAA,GAAgCM,qBAAhC;;WACSK,WAAT,CAAqBC,MAArB,EAA6BC,SAA7B,EAAwC;QAChCC,EAAE,GAAGF,MAAM,CAAC,CAAD,CAAf;QAAoBG,EAAE,GAAGH,MAAM,CAAC,CAAD,CAA/B;QAAoCI,EAAE,GAAGJ,MAAM,CAAC,CAAD,CAA/C;QAAoDK,EAAE,GAAGL,MAAM,CAAC,CAAD,CAA/D;QACIM,GAAG,GAAGJ,EAAE,GAAGK,IAAI,CAACC,GAAL,CAASJ,EAAE,GAAGF,EAAd,IAAoBD,SAAnC;QACIQ,GAAG,GAAGL,EAAE,GAAGG,IAAI,CAACC,GAAL,CAASJ,EAAE,GAAGF,EAAd,IAAoBD,SAAnC;WACO,OAAOC,EAAP,GAAY,GAAZ,GAAkBC,EAAlB,GAAuB,KAAvB,GAA+BG,GAA/B,GAAqC,GAArC,GAA2CH,EAA3C,GAAgD,GAAhD,GAAsDM,GAAtD,GAA4D,GAA5D,GAAkEJ,EAAlE,GAAuE,GAAvE,GAA6ED,EAA7E,GAAkF,GAAlF,GAAwFC,EAA/F;;;EAEJjB,mBAAA,GAAsBW,WAAtB;;WACSW,cAAT,CAAwBC,OAAxB,EAAiCX,MAAjC,EAAyCY,UAAzC,EAAqD;QAC7CC,IAAI,GAAG;MAAEb,MAAM,EAAEA,MAAV;MAAkBY,UAAU,EAAEA,UAA9B;MAA0CE,CAAC,EAAE;KAAxD;IACAH,OAAO,CAACI,OAAR,CAAgB,gBAAhB,EAAkCF,IAAlC;WACOA,IAAI,CAACC,CAAL,IAAUf,WAAW,CAACC,MAAD,EAAS,GAAT,CAA5B;;;EAEJZ,sBAAA,GAAyBsB,cAAzB;;WACSM,gBAAT,CAA0BC,EAA1B,EAA8B;QACtBrB,EAAE,GAAGqB,EAAE,CAACrB,EAAZ;QAAgBkB,CAAC,GAAGG,EAAE,CAACH,CAAvB;QACII,IAAI,GAAGtB,EAAE,CAACuB,aAAH,CAAiB,kBAAjB,CAAX;QACI,CAACD,IAAL,EACI,MAAM,IAAIE,KAAJ,CAAU,+BAAV,CAAN;IACJF,IAAI,CAACG,YAAL,CAAkB,GAAlB,EAAuBP,CAAvB;;;EAEJ1B,wBAAA,GAA2B4B,gBAA3B;;WACSM,gBAAT,CAA0BL,EAA1B,EAA8B;QACtBM,EAAJ;;QACI3B,EAAE,GAAGqB,EAAE,CAACrB,EAAZ;QAAgBkB,CAAC,GAAGG,EAAE,CAACH,CAAvB;QAA0BF,UAAU,GAAGK,EAAE,CAACL,UAA1C;QACIY,OAAO,GAAG,CAACZ,UAAD,GAAc,EAAd,GAAmB,CAC7B,WAAWtB,WAAW,CAACsB,UAAU,CAACa,KAAX,CAAiBC,IAAlB,CADO,EAE7B,YAAYpC,WAAW,CAACsB,UAAU,CAACe,MAAX,CAAkBD,IAAnB,CAFM,EAG7B,kBAAkBpC,WAAW,CAACsB,UAAU,CAACa,KAAX,CAAiBG,MAAjB,CAAwBF,IAAzB,CAHA,EAI7B,mBAAmBpC,WAAW,CAACsB,UAAU,CAACe,MAAX,CAAkBC,MAAlB,CAAyBF,IAA1B,CAJD,CAAjC;QAMIG,GAAG,GAAGC,QAAQ,CAACC,eAAT,CAAyB,4BAAzB,EAAuD,KAAvD,CAAV;QACIb,IAAI,GAAGY,QAAQ,CAACC,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAX;;KACCR,EAAE,GAAGM,GAAG,CAACG,SAAV,EAAqBC,GAArB,CAAyBC,KAAzB,CAA+BX,EAA/B,EAAmClD,cAAc,CAAC,CAAC,YAAD,CAAD,EAAiBmD,OAAjB,CAAjD;;IACAN,IAAI,CAACc,SAAL,CAAeC,GAAf,CAAmB,WAAnB;IACAf,IAAI,CAACG,YAAL,CAAkB,GAAlB,EAAuBP,CAAvB;IACAe,GAAG,CAACM,WAAJ,CAAgBjB,IAAhB;IACAtB,EAAE,CAACuC,WAAH,CAAeN,GAAf;IACAb,gBAAgB,CAAC;MAAEpB,EAAE,EAAEA,EAAN;MAAUkB,CAAC,EAAEA;KAAd,CAAhB;;;EAEJ1B,wBAAA,GAA2BkC,gBAA3B;;;;;;;;;;ACvDA;EACApC,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;IAAEC,KAAK,EAAE;GAAtD;;MAGI+C,UAAU;;cAA8B;aAC/BA,UAAT,CAAoBzB,OAApB,EAA6B0B,UAA7B,EAAyC;WAChC1B,OAAL,GAAeA,OAAf;WACK0B,UAAL,GAAkBA,UAAlB;WACKzC,EAAL,GAAUkC,QAAQ,CAACQ,aAAT,CAAuB,KAAvB,CAAV;WACK1C,EAAL,CAAQ2C,KAAR,CAAcC,QAAd,GAAyB,UAAzB;WACKH,UAAL,CAAgBI,IAAhB,CAAqBN,WAArB,CAAiC,KAAKvC,EAAtC;;;IAEJwC,UAAU,CAACM,SAAX,CAAqBC,sBAArB,GAA8C,UAAUC,EAAV,EAAc;UACpDA,EAAE,KAAK,IAAX,EAAiB;aACRtB,gBAAL,CAAsBsB,EAAtB;OADJ,MAGK,IAAI,KAAKhD,EAAL,CAAQE,aAAZ,EAA2B;aACvBF,EAAL,CAAQiD,SAAR,GAAoB,EAApB;;KALR;;IAQAT,UAAU,CAACM,SAAX,CAAqBI,SAArB,GAAiC,UAAUF,EAAV,EAAc;UACvCG,KAAK,GAAG,KAAKV,UAAL,CAAgBI,IAAhB,CAAqBM,KAAjC;UACI,CAACH,EAAE,CAACI,IAAR,EACI,MAAM,IAAI5B,KAAJ,CAAU,gCAAV,CAAN;UACA4B,IAAI,GAAG,KAAKX,UAAL,CAAgBY,KAAhB,CAAsBpD,GAAtB,CAA0B+C,EAAE,CAACI,IAA7B,CAAX;UACI,CAACA,IAAL,EACI,MAAM,IAAI5B,KAAJ,CAAU,qBAAV,CAAN;;UACAH,EAAE,GAAG+B,IAAI,CAACE,iBAAL,CAAuBN,EAAvB,CAAT;UAAqC1C,EAAE,GAAGe,EAAE,CAAC,CAAD,CAA5C;UAAiDd,EAAE,GAAGc,EAAE,CAAC,CAAD,CAAxD;;aACO2B,EAAE,YAAYO,IAAM,CAACC,MAArB,GACD,CAAClD,EAAD,EAAKC,EAAL,EAAS4C,KAAK,CAACM,CAAf,EAAkBN,KAAK,CAACO,CAAxB,CADC,GAED,CAACP,KAAK,CAACM,CAAP,EAAUN,KAAK,CAACO,CAAhB,EAAmBpD,EAAnB,EAAuBC,EAAvB,CAFN;KARJ;;IAYAiC,UAAU,CAACM,SAAX,CAAqB1B,gBAArB,GAAwC,UAAU4B,EAAV,EAAc;UAC9C9B,CAAC,GAAGyC,KAAO,CAAC7C,cAAR,CAAuB,KAAKC,OAA5B,EAAqC,KAAKmC,SAAL,CAAeF,EAAf,CAArC,CAAR;MACAW,KAAO,CAACvC,gBAAR,CAAyB;QAAEpB,EAAE,EAAE,KAAKA,EAAX;QAAekB,CAAC,EAAEA;OAA3C;KAFJ;;IAIAsB,UAAU,CAACM,SAAX,CAAqBpB,gBAArB,GAAwC,UAAUsB,EAAV,EAAc;UAC9C9B,CAAC,GAAGyC,KAAO,CAAC7C,cAAR,CAAuB,KAAKC,OAA5B,EAAqC,KAAKmC,SAAL,CAAeF,EAAf,CAArC,CAAR;MACAW,KAAO,CAACjC,gBAAR,CAAyB;QAAE1B,EAAE,EAAE,KAAKA,EAAX;QAAekB,CAAC,EAAEA;OAA3C;KAFJ;;WAIOsB,UAAP;GApC4B,EAAhC;;EAsCAhD,kBAAA,GAAqBgD,UAArB;;;;;;AC1CA;EACAlD,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;IAAEC,KAAK,EAAE;GAAtD;;MAGImE,MAAM;;cAA8B;aAC3BA,MAAT,CAAgBC,MAAhB,EAAwB;UAChBC,KAAK,GAAG,IAAZ;;WACKC,GAAL,GAAW,IAAX;WACKF,MAAL,GAAcA,MAAd;WACKG,IAAL,GAAY,IAAIC,IAAM,CAACzB,UAAX,CAAsBqB,MAAtB,EAA8BA,MAAM,CAACG,IAArC,CAAZ;MACAH,MAAM,CAACK,EAAP,CAAU,WAAV,EAAuB,YAAY;eAASJ,KAAK,CAACd,EAAN,IAAYc,KAAK,CAACE,IAAN,CAAW5C,gBAAX,CAA4B0C,KAAK,CAACd,EAAlC,CAAnB;OAArC;;;IAEJ1D,MAAM,CAACC,cAAP,CAAsBqE,MAAM,CAACd,SAA7B,EAAwC,IAAxC,EAA8C;MAC1C7C,GAAG,EAAE,eAAY;eACN,KAAK8D,GAAZ;OAFsC;MAI1CI,GAAG,EAAE,aAAUnB,EAAV,EAAc;aACVe,GAAL,GAAWf,EAAX;aACKgB,IAAL,CAAUjB,sBAAV,CAAiCC,EAAjC;OANsC;MAQ1CoB,UAAU,EAAE,IAR8B;MAS1CC,YAAY,EAAE;KATlB;;IAWAT,MAAM,CAACd,SAAP,CAAiBwB,KAAjB,GAAyB,YAAY;WAC5BtB,EAAL,GAAU,IAAV;KADJ;;IAGAY,MAAM,CAACd,SAAP,CAAiByB,UAAjB,GAA8B,UAAUxC,MAAV,EAAkB;UACxC,CAAC,KAAK8B,MAAL,CAAY1C,OAAZ,CAAoB,gBAApB,EAAsCY,MAAtC,CAAL,EACI;;UACA,KAAKiB,EAAL,YAAmBO,IAAM,CAACiB,KAA9B,EAAqC;YAC7B,CAACzC,MAAM,CAAC0C,mBAAR,IAA+B1C,MAAM,CAAC2C,aAAP,EAAnC,EACI,KAAKb,MAAL,CAAYc,gBAAZ,CAA6B5C,MAAM,CAAC6C,WAAP,CAAmB,CAAnB,CAA7B;aACCf,MAAL,CAAYgB,OAAZ,CAAoB9C,MAApB,EAA4B,KAAKiB,EAAjC;aACKsB,KAAL;;;;UAGA,KAAKtB,EAAT,EACI,KAAKsB,KAAL;WACCtB,EAAL,GAAUjB,MAAV;KAZJ;;IAcA6B,MAAM,CAACd,SAAP,CAAiBgC,SAAjB,GAA6B,UAAUjD,KAAV,EAAiB;UACtCiC,KAAK,GAAG,IAAZ;;UACI,CAAC,KAAKD,MAAL,CAAY1C,OAAZ,CAAoB,gBAApB,EAAsCU,KAAtC,CAAL,EACI;;UACA,KAAKmB,EAAL,KAAY,IAAhB,EAAsB;YACdnB,KAAK,CAAC6C,aAAN,EAAJ,EAA2B;eAClB1B,EAAL,GAAUnB,KAAK,CAAC+C,WAAN,CAAkB,CAAlB,EAAqB7C,MAA/B;eACK8B,MAAL,CAAYc,gBAAZ,CAA6B9C,KAAK,CAAC+C,WAAN,CAAkB,CAAlB,CAA7B;SAFJ,MAIK;eACI5B,EAAL,GAAUnB,KAAV;;;eAEG,IAAP;;;UAEA,CAACA,KAAK,CAAC4C,mBAAP,IAA8B5C,KAAK,CAAC6C,aAAN,EAAlC,EACI,KAAKb,MAAL,CAAYc,gBAAZ,CAA6B9C,KAAK,CAAC+C,WAAN,CAAkB,CAAlB,CAA7B;UACA,CAAC,KAAK5B,EAAL,CAAQyB,mBAAT,IAAgC,KAAKzB,EAAL,CAAQ0B,aAAR,EAApC,EACI,KAAKb,MAAL,CAAYc,gBAAZ,CAA6B,KAAK3B,EAAL,CAAQ4B,WAAR,CAAoB,CAApB,CAA7B;;UACA,KAAK5B,EAAL,YAAmBO,IAAM,CAACC,MAA1B,IAAoC,KAAKR,EAAL,CAAQ+B,WAAR,CAAoBlD,KAApB,CAAxC,EAAoE;YAC5Db,UAAU,GAAGa,KAAK,CAAC+C,WAAN,CAAkBI,IAAlB,CAAuB,UAAUC,CAAV,EAAa;iBAASA,CAAC,CAAClD,MAAF,KAAa+B,KAAK,CAACd,EAA1B;SAAtC,CAAjB;;YACIhC,UAAJ,EAAgB;eACP6C,MAAL,CAAYc,gBAAZ,CAA6B3D,UAA7B;;;;UAGJ,KAAKgC,EAAL,YAAmBO,IAAM,CAACC,MAA9B,EAAsC;aAC7BK,MAAL,CAAYgB,OAAZ,CAAoB,KAAK7B,EAAzB,EAA6BnB,KAA7B;aACKyC,KAAL;;KA1BR;;IA6BAV,MAAM,CAACd,SAAP,CAAiBoC,cAAjB,GAAkC,UAAUlE,UAAV,EAAsB;UAChDe,MAAM,GAAGf,UAAU,CAACe,MAAxB;WACK8B,MAAL,CAAYc,gBAAZ,CAA6B3D,UAA7B;WACKgC,EAAL,GAAUjB,MAAV;KAHJ;;WAKO6B,MAAP;GAtEwB,EAA5B;;EAwEApE,cAAA,GAAiBoE,MAAjB;;;;;;AC5EA;EACAtE,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;IAAEC,KAAK,EAAE;GAAtD;;MACI0F,IAAI;;cAA8B;aACzBA,IAAT,CAAcC,MAAd,EAAsB;WACbA,MAAL,GAAcA,MAAd;WACKC,MAAL,GAAc,IAAd;;;IAEJF,IAAI,CAACrC,SAAL,CAAewC,GAAf,GAAqB,UAAUjE,EAAV,EAAc;UAC3BQ,KAAK,GAAGR,EAAE,CAACQ,KAAf;UAAsBE,MAAM,GAAGV,EAAE,CAACU,MAAlC;UACI,KAAKwD,MAAL,CAAY1D,KAAK,IAAIE,MAArB,CAAJ,EACI;UACAF,KAAJ,EACI,KAAKuD,MAAL,CAAYN,SAAZ,CAAsBjD,KAAtB,EADJ,KAEK,IAAIE,MAAJ,EACD,KAAKqD,MAAL,CAAYb,UAAZ,CAAuBxC,MAAvB,EADC,KAGD,KAAKqD,MAAL,CAAYd,KAAZ;KATR;;IAWAa,IAAI,CAACrC,SAAL,CAAe0C,KAAf,GAAuB,UAAUC,MAAV,EAAkBzC,EAAlB,EAAsB;WACpCsC,GAAL,CAASG,MAAT;WACKJ,MAAL,GAAcrC,EAAd;KAFJ;;IAIAmC,IAAI,CAACrC,SAAL,CAAe4C,QAAf,GAA0B,UAAUD,MAAV,EAAkB;UACpCA,MAAM,KAAK,KAAK,CAApB,EAAuB;QAAEA,MAAM,GAAG,EAAT;;;WACpBH,GAAL,CAASG,MAAT;KAFJ;;IAIAN,IAAI,CAACrC,SAAL,CAAe6C,SAAf,GAA2B,YAAY;aAC5BC,OAAO,CAAC,KAAKP,MAAN,CAAd;KADJ;;IAGAF,IAAI,CAACrC,SAAL,CAAeyC,MAAf,GAAwB,UAAUvC,EAAV,EAAc;UAC9BqC,MAAM,GAAG,KAAKA,MAAlB;WACKA,MAAL,GAAc,IAAd;aACOA,MAAM,IAAIA,MAAM,KAAKrC,EAA5B;KAHJ;;WAKOmC,IAAP;GAhCsB,EAA1B;;EAkCA3F,YAAA,GAAe2F,IAAf;;;;;;ACpCA;EACA7F,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;IAAEC,KAAK,EAAE;GAAtD;;;;;;ACMA,SAASoG,OAAT,CAAiBhC,MAAjB,EAAqC;EACjCA,MAAM,CAACiC,IAAP,CAAY,gBAAZ;EACAjC,MAAM,CAACiC,IAAP,CAAY,gBAAZ;EACAjC,MAAM,CAACiC,IAAP,CAAY,gBAAZ;EACAjC,MAAM,CAACiC,IAAP,CAAY,iBAAZ;MAEMV,MAAM,GAAG,IAAIxB,QAAJ,CAAWC,MAAX,CAAf;MACMkC,IAAI,GAAG,IAAIZ,MAAJ,CAASC,MAAT,CAAb;MACMY,aAAa,GAAG,IAAIC,OAAJ,EAAtB;;WAESC,WAAT,CAAwCC,CAAxC,EAAyD;QAC/CC,UAAU,GAAGJ,aAAa,CAAC/F,GAAd,CAAkB,IAAlB,CAAnB;;QAEGmG,UAAH,EAAe;UACHvE,KADG,GACeuE,UADf,CACHvE,KADG;UACIE,MADJ,GACeqE,UADf,CACIrE,MADJ;MAGX8B,MAAM,CAACG,IAAP,CAAYqC,SAAZ,CAAsBC,aAAtB,CAAoC,IAAIC,YAAJ,CAAiB,aAAjB,EAAgCJ,CAAhC,CAApC;MACAA,CAAC,CAACK,cAAF;MACAL,CAAC,CAACM,eAAF;MACAV,IAAI,CAACP,KAAL,CAAW;QAAE3D,KAAK,EAALA,KAAF;QAASE,MAAM,EAANA;OAApB,EAA8BF,KAAK,IAAIE,MAAvC;;;;WAIC2E,SAAT,CAAiCP,CAAjC,EAAkD;QACxCQ,MAAM,GAAGzE,QAAQ,CAAC0E,gBAAT,CAA0BT,CAAC,CAACU,OAA5B,EAAqCV,CAAC,CAACW,OAAvC,CAAf;;QAEG1B,MAAM,CAACpC,EAAV,EAAc;MACVa,MAAM,CAAC1C,OAAP,CAAe,gBAAf,EAAiCiE,MAAM,CAACpC,EAAxC;;;QAED2D,MAAH,EAAW;MACPZ,IAAI,CAACL,QAAL,CAAc5F,OAAqB,CAACkG,aAAD,EAAgBW,MAAhB,CAArB,IAAgD,EAA9D;;;;EAIR9C,MAAM,CAACK,EAAP,CAAU,iBAAV,EAA6B;WAAM6B,IAAI,CAACL,QAAL,EAAN;GAA7B;EAEA7B,MAAM,CAACK,EAAP,CAAU,cAAV,EAA0B,gBAA2B;QAAxBlE,EAAwB,QAAxBA,EAAwB;QAApB6B,KAAoB,QAApBA,KAAoB;QAAbE,MAAa,QAAbA,MAAa;IACjDiE,aAAa,CAAC7B,GAAd,CAAkBnE,EAAlB,EAAsB;MAAE6B,KAAK,EAALA,KAAF;MAASE,MAAM,EAANA;KAA/B;IAEA/B,EAAE,CAAC+G,mBAAH,CAAuB,aAAvB,EAAsCb,WAAtC;IACAlG,EAAE,CAACgH,gBAAH,CAAoB,aAApB,EAAmCd,WAAnC;GAJJ;EAOAe,MAAM,CAACD,gBAAP,CAAwB,WAAxB,EAAqCN,SAArC;EAEA7C,MAAM,CAACK,EAAP,CAAU,kBAAV,EAA8B,iBAAgC;QAA7BlE,EAA6B,SAA7BA,EAA6B;QAAzBgB,UAAyB,SAAzBA,UAAyB;QAAbZ,MAAa,SAAbA,MAAa;QACpDc,CAAC,GAAGJ,OAAc,CAAC+C,MAAD,EAASzD,MAAT,EAAiBY,UAAjB,CAAxB;IAEAU,OAAgB,CAAC;MAAE1B,EAAE,EAAFA,EAAF;MAAMkB,CAAC,EAADA,CAAN;MAASF,UAAU,EAAVA;KAAV,CAAhB;GAHJ;EAMA6C,MAAM,CAACK,EAAP,CAAU,kBAAV,EAA8B,iBAAgC;QAA7BlE,EAA6B,SAA7BA,EAA6B;QAAzBgB,UAAyB,SAAzBA,UAAyB;QAAbZ,MAAa,SAAbA,MAAa;QACpDc,CAAC,GAAGJ,OAAc,CAAC+C,MAAD,EAASzD,MAAT,EAAiBY,UAAjB,CAAxB;IAEAI,OAAgB,CAAC;MAAEpB,EAAE,EAAFA,EAAF;MAAMkB,CAAC,EAADA;KAAP,CAAhB;GAHJ;EAMA2C,MAAM,CAACK,EAAP,CAAU,SAAV,EAAqB,YAAM;IACvB+C,MAAM,CAACF,mBAAP,CAA2B,WAA3B,EAAwCL,SAAxC;GADJ;;;AAKJ,YAAe;EACX5E,IAAI,EAAE,YADK;EAEX+D,OAAO,EAAPA;CAFJ;;;;;"}